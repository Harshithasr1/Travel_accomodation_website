#!/usr/bin/perl

use strict;
use warnings;

# Set environment variables for Oracle
$ENV{'ORACLE_HOME'} = '/usr/lib/oracle/21/client64';
$ENV{'ORACLE_SID'} = 'csdbora';

# Get the submitted form data from the environment variable
my $query_string = $ENV{'QUERY_STRING'};
my %params = map { split(/=/, $_) } split(/&/, $query_string);

# Get the values submitted by the form
my $name = $params{'empname'};
my $salary = $params{'salary'};

# Determine the search type and value
my ($search_type, $search_value);
if ($name) {
    $search_type = 'n';
    $search_value = $name;
} elsif ($salary) {
    $search_type = 's';
    $search_value = $salary;
}

# Generate the response
print "Content-type: text/html\n\n";
print <<EOF;
<html>
<head>
    <meta charset="utf-8">
    <title>Question 2</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js'></script>
    <style>
        body {
            margin: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
<h3>Assignment-2(Q-2)</h3>

<div class="form-group">
    <label class="form-check-label">
        <input type="radio" name="val" value="name" class="form-check-input" checked> Find by Employee name
    </label>
</div>
<div class="form-group">
    <label class="form-check-label">
        <input type="radio" name="val" value="salary" class="form-check-input"> Find by Salary
    </label>
</div>

<div id="using_name" class="form-group">
    <label for="empname">Enter the Employee full name or part of the name:</label>
    <input type="text" id="empname" name="empname" class="form-control" style="width:250px">
</div>
<div id="using_salary" class="form-group hidden">
    <label for="salary">Enter the Employee salary:</label>
    <input type="number" id="salary" name="salary" class="form-control" style="width:250px">
</div>

<button type="submit" class="btn btn-primary" id="submit">Submit</button>

<script>
        const nameForm = document.getElementById('using_name');
        const salaryForm = document.getElementById('using_salary');

        document.querySelector('input[name="val"]').addEventListener('change', (event) => {
            const selectedValue = event.target.value;
            if (selectedValue === 'name') {
                nameForm.classList.remove('hidden');
                salaryForm.classList.add('hidden');
            } else {
                nameForm.classList.add('hidden');
                salaryForm.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
EOF

print "<html><head><title>Display results</title><link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css' integrity='sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T' crossorigin='anonymous'><script src='https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js'></script><style>table,th, td {border:1px solid black;}</style></head>";

if ($search_value) {
    my $command = '/home/jrm512/public_html/demo/proc/unix-version/c++/sample3';
    my $output = `$command $search_type $search_value`;
    my @rows = split(/\n/, $output);
    my @header = split(/,/, shift(@rows));
    if ($search_type eq 'n') {
        print "<h4>Displaying results for Employee Name Search - $search_value</h4>";
        print "<table><tr><th>Employee Name</th><th>Department Name</th><th>Salary</th><th>Commission</th>";
        foreach my $col (@header) {
            print "<th>$col</th>";
        }
        print "</tr></table>";

        foreach my $row (@rows) {
            my @fields = split(/,/, $row);
            print "<tr>";
            foreach my $field (@fields) {
                print "<td>$field</td>";
            }
            print "</tr>";
        }
        print "</table>";
    } elsif ($search_type eq 's') {
        print "<h4>Displaying results for Employee Salary Search - $search_value</h4>";
        print "<table><tr><th>Employee Name</th><th>Department Name</th><th>Salary</th>";
        for (my $i = 0; $i < 3; $i++) {
            print "<th>@header[$i]</th>";
        }
        print "</tr></table>";

        foreach my $row (@rows) {
            my ($name, $dept, $salary) = split(/,/, $row);
            print "<tr>";
            print "<td>$name</td>";
            print "<td>$dept</td>";
            print "<td>$salary</td>";
            print "</tr>";
        }
        print "</table>";
    }
} else {
    print "<p>No data submitted.</p>";
}

